:root{
  --bg:#0b0e13; --panel:#101622; --muted:#7f8aa3; --text:#e9eefc;
  --accent:#7aa2ff; --border:#1d2740; --chip:#0f1626;
}
*{box-sizing:border-box}
body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text);}
.page{min-height:100vh;display:flex;flex-direction:column}
.topbar{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,#2a4bff,#7aa2ff);display:grid;place-items:center;color:#0b0e13;font-weight:900}
.title{font-weight:900;font-size:14px}
.subtitle{color:var(--muted);font-size:12px;max-width:720px}
.topActions{display:flex;gap:8px;flex-wrap:wrap}
.btn{background:#16223a;color:var(--text);border:1px solid var(--border);padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:700;font-size:13px}
.btn:hover{border-color:#2a3a63}
.btn.primary{background:linear-gradient(135deg,#2a4bff,#7aa2ff);border:none;color:#0b0e13}
.btn.danger{background:#2a1320;border-color:#3d1a2b}
.layout{display:grid;grid-template-columns: 1.15fr .85fr; gap:12px; padding:12px; flex:1; min-height:0}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;overflow:hidden;display:flex;flex-direction:column;min-height:0}
.panelBar{padding:10px;border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.panelBar.right{justify-content:space-between}
.panelBar input, .panelBar select{background:#0f1626;color:var(--text);border:1px solid var(--border);padding:8px 10px;border-radius:10px;outline:none}
.muted{color:var(--muted);font-size:12px}
.small{font-size:12px}
.grid{padding:10px;display:grid;grid-template-columns: repeat(auto-fill,minmax(180px,1fr)); gap:10px; overflow:auto}
.card{border:1px solid var(--border);border-radius:14px;overflow:hidden;background:#0f1626;display:flex;flex-direction:column;cursor:grab}
.thumb{aspect-ratio: 4/3; background:#0b0e13; display:flex; align-items:center; justify-content:center; position:relative}
.thumb img{width:100%;height:100%;object-fit:cover;display:block}
.ph{width:100%;height:100%;display:grid;place-items:center;color:var(--muted);font-weight:900;letter-spacing:1px}
.badge{position:absolute;left:8px;top:8px;background:rgba(16,22,34,.85);border:1px solid var(--border);padding:4px 8px;border-radius:999px;font-size:11px;color:var(--muted)}
.meta{padding:10px;display:flex;flex-direction:column;gap:6px}
.name{font-size:13px;font-weight:900;line-height:1.2}
.row{display:flex;gap:8px;align-items:center;justify-content:space-between}
.mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:11px}
.pill{font-size:11px;border:1px solid var(--border);padding:3px 8px;border-radius:999px;color:var(--muted)}
.tabs{display:flex;gap:8px;flex-wrap:wrap}
.tab{padding:8px 10px;border-radius:999px;border:1px solid var(--border);background:#0f1626;color:var(--muted);cursor:pointer;font-weight:800}
.tab.active{background:rgba(122,162,255,.18);color:var(--text);border-color:#2a3a63}
.barActions{display:flex;gap:8px;flex-wrap:wrap;position:relative;z-index:10}
.btn{position:relative;z-index:10;pointer-events:auto !important}
.rightBody{padding:10px;display:flex;flex-direction:column;gap:10px;overflow:auto;min-height:0}
.scenarioHeader{display:flex;gap:10px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap}
.hint{color:var(--muted);font-size:12px;line-height:1.35;max-width:380px}
.dropzone{border:1px dashed #2a3a63;border-radius:16px;padding:12px;background:rgba(122,162,255,.06);min-height:180px}
.dropzone.dragover{background:rgba(122,162,255,.14)}
.empty{color:var(--muted);font-size:13px}
.list{display:flex;flex-direction:column;gap:8px}
.line{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px;border:1px solid var(--border);border-radius:14px;background:#0f1626}
.lineLeft{display:flex;gap:10px;align-items:center}
.mini{width:56px;height:42px;border-radius:12px;border:1px solid var(--border);overflow:hidden;background:#0b0e13;display:grid;place-items:center}
.mini img{width:100%;height:100%;object-fit:cover}
.phMini{color:var(--muted);font-weight:900}
.lineName{font-weight:900;font-size:13px}
.lineRight{display:flex;gap:8px;align-items:center}
.qty{width:72px;background:#0b0e13;color:var(--text);border:1px solid var(--border);padding:8px 10px;border-radius:10px}
.out{width:100%;height:140px;background:#0f1626;color:var(--text);border:1px solid var(--border);border-radius:14px;padding:10px;resize:vertical}

/* JTBD Modal */
.modal-overlay{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;background:rgba(11,14,19,.85) !important;backdrop-filter:blur(4px);display:flex !important;align-items:flex-start !important;justify-content:center !important;z-index:10000 !important;padding:20px;overflow-y:auto;overscroll-behavior:contain}
.modal-content{background:var(--panel);border:1px solid var(--border);border-radius:20px;max-width:680px;width:calc(100% - 40px);max-height:calc(100vh - 40px);overflow:hidden;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,.4);position:fixed !important;top:20px !important;left:50% !important;transform:translateX(-50%) !important;z-index:10001 !important;margin:0}
.modal-header{padding:20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.modal-header h2{margin:0;font-size:18px;font-weight:900;color:var(--text)}
.modal-close{background:none;border:none;color:var(--muted);font-size:28px;cursor:pointer;padding:0;width:32px;height:32px;display:grid;place-items:center;border-radius:8px;line-height:1}
.modal-close:hover{background:rgba(122,162,255,.1);color:var(--text)}
.modal-body{padding:20px;overflow-y:auto;flex:1;max-height:calc(90vh - 140px)}
.jtbd-prompt{line-height:1.6;color:var(--text)}
.jtbd-prompt h3{margin:16px 0 8px;font-size:16px;font-weight:900;color:var(--accent)}
.jtbd-prompt p{margin:8px 0;font-size:14px}
.jtbd-item{margin:12px 0;padding-left:8px;border-left:3px solid var(--accent);font-weight:600}
.modal-footer{padding:20px;border-top:1px solid var(--border);display:flex;justify-content:flex-end}
.loading-jtbd{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;gap:16px}
.spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-jtbd p{color:var(--muted);font-size:14px}

@media (max-width: 980px){ .layout{grid-template-columns:1fr; } }
